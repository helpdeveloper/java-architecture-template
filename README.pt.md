# **Java Project Architecture Template**

<p align="center">
  <img src=".images/banner.webp" width="800">
</p>

Aqui voc√™ deve descrever seu projeto, seu funcionamento e seus objetivos, tornando-o claro para todos. Exemplo:

O **Java Architecture Template** √© um projeto criado para servir como modelo na cria√ß√£o de aplica√ß√µes, visando um desenvolvimento com **qualidade t√©cnica excepcional** para garantir **manuten√ß√£o a longo prazo**.  
Neste template, fornecemos um **endpoint de cadastro de usu√°rio**, que **dispara um evento no broker** quando um usu√°rio √© registrado. Um **listener recebe esses eventos** de cria√ß√£o e os enriquece com dados de endere√ßo.

üìö Leia em:
- üá¨üáß [English](README.md)
---

## **Architecture**

Este projeto segue a **Arquitetura Hexagonal**, conforme proposta por **Alistair Cockburn**, focando em **desacoplar a l√≥gica de neg√≥cio principal da aplica√ß√£o de seus mecanismos de entrada e sa√≠da**. Esse princ√≠pio de design promove **adaptabilidade, testabilidade e sustentabilidade**, encapsulando a camada de aplica√ß√£o (n√∫cleo de neg√≥cio) e expondo portas definidas para intera√ß√£o com sistemas externos.

<p align="center">
    <img src=".images/hexagonal.png" width="500">
</p>

### **Core Concept**

A arquitetura isola a l√≥gica central do dom√≠nio estruturando a aplica√ß√£o em camadas distintas:

- **Adapters Layer**: Respons√°vel pela comunica√ß√£o com sistemas externos (ex.: bancos de dados, APIs ou interfaces de usu√°rio). Dividida em:
  - **Input Adapters**: Lidam com requisi√ß√µes que chegam na aplica√ß√£o, como requisi√ß√µes HTTP ou eventos.
  - **Output Adapters**: Implementam a comunica√ß√£o com sistemas externos, como reposit√≥rios ou servi√ßos externos.

- **Core Layer**: Representa o n√∫cleo da aplica√ß√£o:
  - **Domain**: Cont√©m as entidades de neg√≥cio principais, objetos de valor e agregados.
  - **Use Cases**: Encapsula os fluxos de trabalho da aplica√ß√£o e orquestra as intera√ß√µes entre objetos de dom√≠nio e portas.
  - **Ports**: Define interfaces para intera√ß√µes de entrada e sa√≠da, garantindo que o n√∫cleo permane√ßa independente de frameworks.

_Read more about: [O Core Domain: Modelando Dom√≠nios Ricos](https://medium.com/inside-picpay/o-core-domain-modelando-dom%C3%ADnios-ricos-f1fe664c998f)
and [O Use Case: Modelando as Intera√ß√µes do Seu Dom√≠nio](https://medium.com/inside-picpay/o-use-case-modelando-as-intera%C3%A7%C3%B5es-do-seu-dom%C3%ADnio-c6c568270d0c)_

### **Project Structure**

A estrutura segue os princ√≠pios da Arquitetura Hexagonal, conforme demonstrado abaixo:

```plaintext
application
    br.com.helpdev.sample
    ‚îú‚îÄ‚îÄ adapters
    ‚îÇ   ‚îú‚îÄ‚îÄ input         # Controladores, listeners de eventos ou outros pontos de entrada
    ‚îÇ   ‚îú‚îÄ‚îÄ output        # Reposit√≥rios de banco de dados, clientes de APIs externas, etc.
    ‚îú‚îÄ‚îÄ config            # Arquivos de configura√ß√£o e ajustes da aplica√ß√£o
    ‚îú‚îÄ‚îÄ core              # L√≥gica de neg√≥cio central
    ‚îÇ   ‚îú‚îÄ‚îÄ ports
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ input     # Interfaces que definem intera√ß√µes de entrada (ex.: comandos, consultas)
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ output    # Interfaces que definem intera√ß√µes de sa√≠da (ex.: persist√™ncia, APIs externas)
    ‚îÇ   ‚îú‚îÄ‚îÄ domain        # Entidades, objetos de valor e agregados
    ‚îÇ   ‚îú‚îÄ‚îÄ usecases      # Fluxos de trabalho espec√≠ficos da aplica√ß√£o
    
acceptance-test
    # Integration tests with real Docker application.
```

### **Architecture Tests**

Esta arquitetura √© garantida por meio de testes **ArchUnit**, que validam a conformidade do projeto com os princ√≠pios da Arquitetura Hexagonal, assegurando a separa√ß√£o de responsabilidades e a independ√™ncia da l√≥gica de neg√≥cio central em rela√ß√£o aos sistemas externos.

_Read more about: [Garantindo a arquitetura de uma aplica√ß√£o sem complexidade](https://medium.com/luizalabs/garantindo-a-arquitetura-de-uma-aplica%C3%A7%C3%A3o-sem-complexidade-6f675653799c)_

---

### **Acceptance Tests**

Para garantir testes robustos, o m√≥dulo **acceptance-test** encapsula a aplica√ß√£o dentro de uma imagem Docker e executa testes de integra√ß√£o em um ambiente que imita de perto o comportamento real da aplica√ß√£o. Essa abordagem garante a homogeneidade nos m√≥dulos da aplica√ß√£o ao restringir os testes unit√°rios ao m√≥dulo principal, enquanto lida com testes de integra√ß√£o separadamente no m√≥dulo acceptance-test.
Esta separa√ß√£o garante:

1. **Ambientes de teste realistas**: Os testes de integra√ß√£o s√£o realizados em condi√ß√µes que se assemelham ao ambiente de tempo de execu√ß√£o real, melhorando a confiabilidade
   do teste.

2. **Escopo de teste claro**: Os testes de unidade focam somente em componentes isolados dentro do aplicativo principal, enquanto os testes de integra√ß√£o validam fluxos de trabalho de ponta a ponta
   e intera√ß√µes externas.

3. **Facilidade de implanta√ß√£o**: O encapsulamento no Docker permite a implanta√ß√£o e execu√ß√£o perfeitas de testes em diferentes ambientes.

Ao aderir a essa estrat√©gia, o m√≥dulo de teste de aceita√ß√£o se torna uma parte essencial da manuten√ß√£o da integridade e confiabilidade do aplicativo
durante seu ciclo de vida. Ver m√≥dulo [README](acceptance-test/README.md).

_Leia mais sobre: [Separando os testes integrados de sua aplica√ß√£o em um novo conceito](https://medium.com/luizalabs/separando-os-testes-integrados-de-sua-aplica%C3%A7%C3%A3o-em-um-novo-conceito-4f511ebb53a4)_

---

## **Getting Started**

Este projeto fornece uma stack local completa com todas as depend√™ncias necess√°rias para executar o aplicativo. Al√©m disso, est√° incluido um ambiente de observabilidade
usando **OpenTelemetry** e **Grafana**.

### **Prerequisites**

Certifique-se de ter as seguintes ferramentas instaladas em sua m√°quina:

- **Docker**: [Install Docker](https://docs.docker.com/get-docker/)
- **Docker Compose**: [Install Docker Compose](https://docs.docker.com/compose/install/)
- **Java 21**: [Download Java 21](https://www.oracle.com/java/technologies/javase/jdk21-archive-downloads.html)

_Observa√ß√£o: o Maven foi incorporado ao projeto para evitar a necessidade de instal√°-lo em sua m√°quina._

### **Running the Project**

Para uma experi√™ncia de desenvolvimento perfeita, o projeto inclui um Makefile com comandos predefinidos para simplificar tarefas comuns. Esses comandos encapsulam

1. **Run Tests**:
  - `make run-unit-tests`: Runs unit tests for the application.
  - `make run-acceptance-tests`: Executes acceptance tests using Docker.
  - `make run-all-tests`: Executes all tests, including unit and **integration tests**.

2. **Run Application**:
  - `make mvn-run`: Runs the application with Spring Boot using the `local` profile.

3. **Run Infrastructure**:
  - `make run-infrastructure`: Starts infrastructure services using Docker Compose.
  - `make run-observability`: Starts observability services (OpenTelemetry, Grafana).
  - `make run-stack`: Starts both infrastructure and observability services.

4. **Run Entire Application**:
  - `make run-app`: Starts the application services.
  - `make run-all`: Starts the entire stack (infrastructure, observability, and application).

5. **Stop Services**:
  - `make stop-infra`: Stops infrastructure services.
  - `make stop-observability`: Stops observability services.
  - `make stop-stack`: Stops both infrastructure and observability services.
  - `make stop-app`: Stops the application services.
  - `make stop-all`: Stops all running services (infrastructure, observability, and application).

Esta configura√ß√£o garante uma experi√™ncia de desenvolvimento eficiente e consistente, permitindo integra√ß√£o e monitoramento perfeitos em um ambiente local.

### **The Flyway Database Migration Tool**

Para garantir um melhor desempenho de inicializa√ß√£o e evitar problemas de concorr√™ncia em ambientes Kubernetes, o **Flyway** foi implementado como uma ferramenta de migra√ß√£o de banco de dados desacoplada. Este design permite que o processo de migra√ß√£o seja executado de forma independente da aplica√ß√£o.

Principais Caracter√≠sticas:

- **Execu√ß√£o Pr√©-implanta√ß√£o**: Scripts de migra√ß√£o e o comando Flyway est√£o inclu√≠dos em uma imagem Docker, permitindo que sejam executados como um pre-hook durante implanta√ß√µes no Kubernetes ou usando outras estrat√©gias de orquestra√ß√£o.
- **Evitando Conten√ß√£o**: Ao desacoplar as migra√ß√µes da inicializa√ß√£o da aplica√ß√£o, poss√≠veis condi√ß√µes de corrida ou gargalos de recursos s√£o mitigados.
- **Consist√™ncia Entre Ambientes**: Garante que todas as migra√ß√µes de banco de dados sejam aplicadas antes da implanta√ß√£o da aplica√ß√£o, mantendo a consist√™ncia.

Essa abordagem melhora a confiabilidade da implanta√ß√£o e mant√©m uma separa√ß√£o clara de responsabilidades, alinhando-se aos princ√≠pios arquitet√¥nicos do projeto.

Voc√™ pode ver um exemplo de como executar em: [arquivo docker-compose da aplica√ß√£o](.docker-compose-local/application/docker-compose.yml).

### **Available Infrastructure**

A pilha local tamb√©m inclui servi√ßos de infraestrutura para dar suporte ao aplicativo. Esses servi√ßos s√£o acess√≠veis em `localhost` e fornecem funcionalidades
essenciais:

- **Grafana**: Visualization and monitoring dashboard, available at [http://localhost:3000](http://localhost:3000).
- **Prometheus**: Metrics collection and monitoring system, available at [http://localhost:9090](http://localhost:9090).
- **Jaeger**: Distributed tracing system, available at [http://localhost:16686](http://localhost:16686).
- **MySQL**: Relational database system, accessible at `localhost:3306`.
- **Kafka**: Event streaming platform, available at `localhost:9092`.

Esses servi√ßos s√£o orquestrados usando o Docker Compose para garantir configura√ß√£o e opera√ß√£o perfeitas em um ambiente de desenvolvimento local.
---

## **Architectural Decision Records (ADR)**
O projeto inclui uma pasta dedicada para **Registros de Decis√µes Arquiteturais (ADR)**, localizada no diret√≥rio `adr`. Esta pasta documenta as principais
decis√µes arquiteturais tomadas ao longo do projeto, fornecendo contexto, justificativa e implica√ß√µes para essas escolhas.

Para saber mais sobre os ADRs e explorar as decis√µes documentadas, consulte o [README do ADR](./adr/README.md).

---
## **Contribua**

Pull Requests s√£o bem-vindos. Para mudan√ßas significativas, por favor, abra uma issue primeiro para discutir o que voc√™ gostaria de mudar. Certifique-se de atualizar os testes conforme apropriado.

---
_**Projeto de Template de Arquitetura proposto por Guilherme Biff Zarelli**_

- **Blog/Site**: [https://helpdev.com.br](https://helpdev.com.br)
- **LinkedIn**: [https://linkedin.com/in/gbzarelli/](https://linkedin.com/in/gbzarelli/)
- **GitHub**: [https://github.com/gbzarelli](https://github.com/gbzarelli)
- **Artigos no Medium**: [https://medium.com/@guilherme.zarelli](https://medium.com/@guilherme.zarelli)
- **Email**: [gbzarelli@helpdev.com.br](mailto:gbzarelli@helpdev.com.br)

_Bom design de software, como Robert C. Martin enfatiza em seu livro *Clean Architecture: A Craftsman's Guide to Software Structure and Design*, visa *
*minimizar os recursos humanos necess√°rios para construir e manter um sistema**. Este template de projeto se inspira em desafios e experi√™ncias do mundo real,
fornecendo uma perspectiva abrangente sobre a constru√ß√£o de arquiteturas dur√°veis e de f√°cil manuten√ß√£o._

> *"The only way to go fast, is to go well."*  
> ‚Äì **Robert C. Martin**
